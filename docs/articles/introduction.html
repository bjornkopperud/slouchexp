<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slouch introduction • slouch</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Slouch introduction">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">slouch</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Slouch introduction</a>
    </li>
    <li>
      <a href="../articles/manual.html">Manual</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/kopperud/slouch">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Slouch introduction</h1>
                        <h4 class="author">Bjørn Tore Kopperud</h4>
            
            <h4 class="date">2018-04-18</h4>
      
      <small>Source: <a href="http://github.com/kopperud/slouch/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>SLOUCH is an implementation of a particular phylogenetic comparative method. It can fit univariate among-species Ornstein-Uhlenbeck models of phenotypic trait evolution, where the trait evolves towards a primary optimum. Optima can be fitted either as discrete regimes as niches on the phylogenetic tree, and/or with continuous covariates. This document is not meant to be exhaustive nor cover the biological interpretations in any depth; it is merely a short introduction on software syntax and a few technical issues. For more information about the theoretical background, how the method is derived, and how to interpret the models, see the associated literature:</p>
<ul>
<li>Hansen (1997)<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>
</li>
<li>Butler &amp; King (2004)<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>
</li>
<li>Hansen <em>et al.</em> (2008)<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>
</li>
<li>Labra <em>et al.</em> (2009)<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>
</li>
<li>Escudero <em>et al.</em> (2012)<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a>
</li>
<li>Hansen &amp; Bartoszek (2012)<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a>
</li>
<li>Hansen (2014)<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a>
</li>
<li>O’Meara &amp; Beaulieu (2014)<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a>
</li>
<li>Toljagić <em>et al.</em> (2017)<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a>
</li>
</ul>
<div id="prerequisites" class="section level3">
<h3 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h3>
<p>In order to fit Ornstein-Uhlenbeck models in SLOUCH, we will need to have a rooted phylogenetic tree of interest in the <code>phylo</code> format, from package <code>ape</code>. Polytomies and non-branching edges are allowed. Both ultrametric and non-ultrametric trees can be used, but this will have implications for reliable estimation of certain parameters. For the purposes of illustrating syntax, we will use a dataset of artiodactyl neocortices bundled with the package (see <code><a href="../reference/neocortex.html">?neocortex</a></code>), and a corresponding phylogenetic tree (Toljagić <em>et al.</em> 2017). First, we will organize the neocortex data and associated annotation data.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load necessary packages</span>
<span class="kw">library</span>(ape)
<span class="kw">library</span>(slouch)

## Load the phylogenetic tree with annotation data
<span class="kw">data</span>(artiodactyla)
phy &lt;-<span class="st"> </span>artiodactyla

## Load the neocortex dataset
<span class="kw">data</span>(neocortex)

## Plot the tree
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))
<span class="kw">plot</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ape/topics/ladderize">ladderize</a></span>(phy), <span class="dt">cex =</span> <span class="fl">0.6</span>)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</code></pre></div>
<p>Now, we have a phylogenetic tree with corresponding morphological data for all of the extant species. If you use your own data to fit models, it is recommended to store the data for the terminal branches in a data frame or in a similar data structure. In order to line up the data frame with the tree, SLOUCH requires the species in the data frame need to be in a particular order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Check whether they are lined up correctly
neocortex<span class="op">$</span>species <span class="op">==</span><span class="st"> </span>phy<span class="op">$</span>tip.label</code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE  TRUE
## [12]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [34] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<p>Unsurprisingly, not all of the species are in their correct places; we will have to reorder the data framv. Here is one way to do it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">neocortex &lt;-<span class="st"> </span>neocortex[<span class="kw">match</span>(phy<span class="op">$</span>tip.label, neocortex<span class="op">$</span>species), ]

## Check if they line up again
neocortex<span class="op">$</span>species <span class="op">==</span><span class="st"> </span>phy<span class="op">$</span>tip.label</code></pre></div>
<pre><code>##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [15] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [29] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [43] TRUE</code></pre>
</div>
<div id="single-optimum-model" class="section level3">
<h3 class="hasAnchor">
<a href="#single-optimum-model" class="anchor"></a>Single-optimum model</h3>
<p>Now we are ready to fit the first models, for which we will use the function <code>slouch.fit</code>. The following is an intercept-only model, or a single-optimum model. In <code>slouch</code>, there are two main techniques for estimating the most likely <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\sigma_y^2\)</span> parameters. In this particular implementation the <span class="math inline">\(\sigma_y^2\)</span> is reparameterized as <span class="math inline">\(\sigma_y^2/2\alpha\)</span>, which is the variance of the residuals of the response variable when it is stationary around the optimum. The <span class="math inline">\(\alpha\)</span> is reparameterized as <span class="math inline">\(t_{1/2} = \log(2)/\alpha\)</span>, which is the phylogenetic half-life. The first way is to use a grid-search of likely parameters from user input, which may take some trial and error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">hl_values =</span> <span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="dv">12</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                     <span class="dt">vy_values =</span> <span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean)


model1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">hl_values =</span> <span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="dv">150</span>, <span class="dt">length.out =</span> <span class="dv">25</span>),
                     <span class="dt">vy_values =</span> <span class="kw">seq</span>(<span class="fl">0.1</span>, <span class="fl">2.5</span>, <span class="dt">length.out =</span> <span class="dv">25</span>),
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean)
<span class="kw">plot</span>(model0)
<span class="kw">plot</span>(model1)</code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/unnamed-chunk-4-1.png" alt="Log likelihood surface for the OU model" width="672"><img src="introduction_files/figure-html/unnamed-chunk-4-2.png" alt="Log likelihood surface for the OU model" width="672"><p class="caption">
Log likelihood surface for the OU model
</p>
</div>

<p>These plots of the likelihood surfaces are both based on the same data, but with different grid location and resolution. The optima and model fit statistics that are reported in the output are conditional on the combination of these <span class="math inline">\(t_{1/2}\)</span> and <span class="math inline">\(\sigma_y^2/2\alpha\)</span> that give the highest log-likelihood; in this case the peak of the surface in the likelihood plot. If the grid-search does not contain the true maximum likelihood, the model outputs will reflect this. It is also possible to use other packages to plot the grid-search likelihood surface, for a more aesthetic look (not run).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)
p &lt;-<span class="st"> </span><span class="kw">plot_ly</span>(<span class="dt">x =</span> model0<span class="op">$</span>supportplot<span class="op">$</span>hl,
             <span class="dt">y =</span> model0<span class="op">$</span>supportplot<span class="op">$</span>vy,
             <span class="dt">z =</span> model0<span class="op">$</span>supportplot<span class="op">$</span>z) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">add_surface</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">layout</span>(<span class="dt">title =</span> <span class="st">"Grid-search"</span>,
         <span class="dt">scene =</span> <span class="kw">list</span>(<span class="dt">xaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Phylogenetic half-life"</span>), 
                      <span class="dt">yaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Stationary variance"</span>),
                      <span class="dt">zaxis =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">"Log-likelihood"</span>)))

p</code></pre></div>

<p>Another, perhaps more convenient way of estimating parameters is to use the hillclimber function. On default it will start on a random combination of <span class="math inline">\(t_{1/2}\)</span> and <span class="math inline">\(\sigma_y^2/2\alpha\)</span>, but this may also be specified. While the hillclimber might seem both faster and more accurate at first glance, there are some drawbacks. If the likelihood search space has one or more local maxima, the hillclimber may converge at a sub-optimal location and give parameter estimates that are not truly maximum-likelihood estimates. Additionally, even though the hillclimber may converge at some local or global maximum, it will not indicate whether the support region of the parameters is narrow or wide. One problem when using the hillclimber is that, depending on the specified model, the residual variance-covariance matrix <span class="math inline">\(\mathbf{V}\)</span> may collapse if <span class="math inline">\(\sigma_y^2/2\alpha\)</span> reaches zero. The immediate consequence is that matrix is non-invertible, and the program will crash. If within-species observational error is non-zero and added to the model, this does not happen. In order to use the hillclimber in this scenario, it may be necessary to constrain its search space such that <span class="math inline">\(\sigma_y^2/2\alpha\)</span> does not enter zero or close to zero. The exact feasible boundary for this may depend on the scale of the response trait.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean,
                     <span class="dt">hillclimb =</span> <span class="ot">TRUE</span>,
                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>))
<span class="kw">plot</span>(model2)</code></pre></div>
<p>The maximum-likelihood estimate of the phylogenetic half-life (<span class="math inline">\(t_{1/2} = \log(2)/\alpha\)</span>) was very large for this model, and the rate of adaptation (<span class="math inline">\(\alpha\)</span>) was practically zero. The units of the phylogenetic half-lives are the same units as the branch lengths in the phylogenetic tree, <code>phy$edge.length</code>. The total depth, or distance from the root, can for all nodes be calculated with <code><a href="http://www.rdocumentation.org/packages/ape/topics/node.depth">node.depth.edgelength(phy)</a></code>. For this phylogenetic tree the maximum depth is about 27 million years. Given that the estimated half-life <span class="math inline">\(t_{1/2}\)</span> was many times larger than the total length of the phylogeny, and that <span class="math inline">\(\alpha\)</span> is very close to zero, we can conclude that there is next to no strength of attraction towards the optimum. If there is no such pull, the model collapses to a Brownian motion.</p>
</div>
<div id="optima-as-a-linear-regression" class="section level3">
<h3 class="hasAnchor">
<a href="#optima-as-a-linear-regression" class="anchor"></a>Optima as a linear regression</h3>
<p>SLOUCH can also fit the optimum as a linear regression with one or more continuous covariates. The covariates may either be fitted as direct effects without a phylogenetic covariance structure, or as univariate Brownian-motion variables. We will first fit log brain mass as a direct effect covariate.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean,
                     <span class="dt">direct.cov =</span> neocortex<span class="op">$</span>brain_mass_g_log_mean,
                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>),
                     <span class="dt">hillclimb =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(model3)


<span class="kw">plot</span>(<span class="dt">x =</span> neocortex<span class="op">$</span>brain_mass_g_log_mean, 
     <span class="dt">y =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean, 
     <span class="dt">xlab =</span> <span class="st">"Mean log brain mass (g)"</span>,
     <span class="dt">ylab =</span> <span class="st">"Mean log neocortex area (mm2)"</span>,
     <span class="dt">main =</span> <span class="st">"Trait plot"</span>)
<span class="kw">abline</span>(<span class="kw">lm</span>(neocortex_area_mm2_log_mean <span class="op">~</span><span class="st"> </span>brain_mass_g_log_mean,
          <span class="dt">data =</span> neocortex), 
       <span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">abline</span>(model3<span class="op">$</span>opt.reg<span class="op">$</span>coefficients[,<span class="dv">1</span>], 
       <span class="dt">col =</span> <span class="st">"orange"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
model3<span class="op">$</span>opt.reg<span class="op">$</span>coefficients</code></pre></div>
<pre><code>##                                 Estimates Std. error
## (Intercept)                     5.4488683 0.23769229
## neocortex$brain_mass_g_log_mean 0.8339189 0.04414703</code></pre>
<p><img src="introduction_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>While the single-optimum model showed a very strong phylogenetic inertia, in this model it is somewhat lower with a phylogenetic half-life (<span class="math inline">\(t_{1/2}\)</span>) of 16.9 myr. In this case, the regression line estimated using ordinary least squares is almost indistinguishable from the Ornstein-Uhlenbeck optimal regression. It is also possible to fit a model with multiple continuous covariates, however the input to <code>direct.cov</code> must be a matrix or data frame that has column names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model4 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
             <span class="dt">species =</span> neocortex<span class="op">$</span>species,
             <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean,
             <span class="dt">direct.cov =</span> <span class="kw">cbind</span>(<span class="dt">brain =</span> neocortex<span class="op">$</span>brain_mass_g_log_mean, 
                               <span class="dt">body =</span> neocortex<span class="op">$</span>body_mass_g_log_mean),
             <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>),
             <span class="dt">hillclimb =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(model4)</code></pre></div>
</div>
<div id="multiple-optima-phylo-format" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-optima-phylo-format" class="anchor"></a>Multiple optima &amp; phylo-format</h3>
<p>SLOUCH can fit models with multiple adaptive regimes or niches over the branches of the phylogenetic tree. We will fit neocortex size as a function of diet in artiodactyls. Trees in the <code>phylo</code> format are represented by the edges found in <code>phy$edge</code>, where each edge connects two vertices or nodes. All of the tip nodes have indices starting from 1, 2, 3 … until <span class="math inline">\(n_{tips}\)</span>, in this case 43. The root node has index <span class="math inline">\(n_{tips}\)</span>+1, here 44, and the rest of the internal nodes have indices (<span class="math inline">\(n_{tips}\)</span>+2, <span class="math inline">\(n_{tips}\)</span>+3, …, <span class="math inline">\(n_{nodes}\)</span>). When running this type of model, we will need to specify the internal adaptive regimes in the order of node indices (<span class="math inline">\(n_{tips}\)</span>+1, <span class="math inline">\(n_{tips}\)</span>+2, <span class="math inline">\(n_{tips}\)</span>+3, …, <span class="math inline">\(n_{nodes}\)</span>). In order to plot and visually verify that the ancestral state configuration is sensible, we need to have all the regimes in the order of the <strong>edges</strong>, not the nodes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Inspect the internal node regimes
## These have order n+1, n+2, n+3 ...
internal_regimes &lt;-<span class="st"> </span><span class="kw">factor</span>(phy<span class="op">$</span>node.label)

## Concatenate tip and internal regimes. These will have order 1,2,3 ...
regimes &lt;-<span class="st"> </span><span class="kw">c</span>(neocortex<span class="op">$</span>diet, internal_regimes)

## Pick out the regimes of the edges, in the order of phy$edge
edge_regimes &lt;-<span class="st"> </span><span class="kw">factor</span>(regimes[phy<span class="op">$</span>edge[,<span class="dv">2</span>]])

<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))
<span class="kw">plot</span>(phy, 
     <span class="dt">edge.color =</span> <span class="kw">c</span>(<span class="st">"Black"</span>, <span class="st">"Orange"</span>, <span class="st">"blue"</span>)[edge_regimes], 
     <span class="dt">edge.width =</span> <span class="dv">3</span>, <span class="dt">cex =</span> <span class="fl">0.6</span>)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</code></pre></div>
<p>If it looks like there are no visible mistakes, we can go ahead and fit the model in SLOUCH.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model5 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean,
                     <span class="dt">direct.cov =</span> neocortex<span class="op">$</span>brain_mass_g_log_mean,
                     <span class="dt">fixed.fact =</span> neocortex<span class="op">$</span>diet,
                     <span class="dt">hillclimb =</span> <span class="ot">TRUE</span>,
                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>))

model5<span class="op">$</span>opt.reg<span class="op">$</span>coefficients</code></pre></div>
<pre><code>##                                 Estimates Std. error
## Br                              5.3746627 0.22276529
## Gr                              5.6045139 0.30280262
## MF                              5.5558924 0.22390082
## neocortex$brain_mass_g_log_mean 0.8203544 0.04314232</code></pre>
</div>
<div id="adaptation-model" class="section level3">
<h3 class="hasAnchor">
<a href="#adaptation-model" class="anchor"></a>Adaptation model</h3>
<p>SLOUCH can also fit models with continuous covariates that themselves have a phylogenetic covariance structure. Currently the only option is to model them as univariate Brownian motions. If <span class="math inline">\(\alpha &gt; 0\)</span>, the optimal regression and the evolutionary regression will differ. Here, both the grid-search and the hillclimber routine are used to find the maximum-likelihood estimates for <span class="math inline">\(t_{1/2}\)</span> and <span class="math inline">\(\sigma_y^2/2\alpha\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model6 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">hl_values =</span> <span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">25</span>),
                     <span class="dt">vy_values =</span> <span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>, <span class="dt">length.out =</span> <span class="dv">25</span>),
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean,
                     <span class="dt">random.cov =</span> neocortex<span class="op">$</span>brain_mass_g_log_mean,
                     <span class="dt">hillclimb =</span> <span class="ot">TRUE</span>,
                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.0005</span>))

model6<span class="op">$</span>opt.reg<span class="op">$</span>coefficients</code></pre></div>
<pre><code>##                                      Estimates Std. error
## (Intercept)                          5.3406859 0.21881752
## neocortex$brain_mass_g_log_mean (bm) 0.9864637 0.04678965</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(model6)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</div>
<div id="observational-error" class="section level3">
<h3 class="hasAnchor">
<a href="#observational-error" class="anchor"></a>Observational error</h3>
<p>Slouch can incorporate estimates of observational error by specifying the within-species estimation variances. For example, if <span class="math inline">\(X\)</span> is the mean log brain mass for each species, the statistic for the measurement error argument would be the variance of the mean log brain mass for each species.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model7 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/slouch.fit.html">slouch.fit</a></span>(<span class="dt">phy =</span> phy,
                     <span class="dt">hl_values =</span> <span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="dv">4</span>, <span class="dt">length.out =</span> <span class="dv">25</span>),
                     <span class="dt">vy_values =</span> <span class="kw">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.05</span>, <span class="dt">length.out =</span> <span class="dv">25</span>),
                     <span class="dt">species =</span> neocortex<span class="op">$</span>species,
                     <span class="dt">response =</span> neocortex<span class="op">$</span>neocortex_area_mm2_log_mean,
                     <span class="dt">mv.response =</span> neocortex<span class="op">$</span>neocortex_se_squared,
                     <span class="dt">random.cov =</span> neocortex<span class="op">$</span>brain_mass_g_log_mean,
                     <span class="dt">mv.random.cov =</span> neocortex<span class="op">$</span>brain_se_squared,
                     <span class="dt">hillclimb =</span> <span class="ot">TRUE</span>,
                     <span class="dt">lower =</span> <span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.001</span>))

<span class="kw">plot</span>(model7)</code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>If the observational errors are non-zero, the generalized least squares estimator may be biased. A bias correction for the regression coefficients is implemented according to Hansen &amp; Bartoszek (2012), but the parameter search and the reported model-fit statistics are conditional on the <em>naive</em> optimal regression.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Hansen, T. F. (1997). Stabilizing Selection and the Comparative Analysis of Adaptation. Evolution, 51(5), 1341. <a href="https://doi.org/10.2307/2411186" class="uri">https://doi.org/10.2307/2411186</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Butler, M. A., &amp; King, A. A. (2004). Phylogenetic comparative analysis: a modeling approach for adaptive evolution. American Naturalist, 164(6), 683–695. <a href="https://doi.org/10.1086/426002" class="uri">https://doi.org/10.1086/426002</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Hansen, T. F., Pienaar, J., &amp; Orzack, S. H. (2008). A comparative method for studying adaptation to a randomly evolving environment. Evolution, 62(8), 1965–1977. <a href="https://doi.org/10.1111/j.1558-5646.2008.00412.x" class="uri">https://doi.org/10.1111/j.1558-5646.2008.00412.x</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Labra, A., Pienaar, J., &amp; Hansen, T. F. (2009). Evolution of Thermal Physiology in Liolaemus Lizards: Adaptation, Phylogenetic Inertia, and Niche Tracking. The American Naturalist, 174(2), 204–220. <a href="https://doi.org/10.1086/600088" class="uri">https://doi.org/10.1086/600088</a><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>Escudero, M., Hipp, A. L., Hansen, T. F., Voje, K. L., &amp; Luceño, M. (2012). Selection and inertia in the evolution of holocentric chromosomes in sedges (Carex, Cyperaceae). New Phytologist, 195(1), 237–247. <a href="https://doi.org/10.1111/j.1469-8137.2012.04137.x" class="uri">https://doi.org/10.1111/j.1469-8137.2012.04137.x</a><a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>Hansen, T. F., &amp; Bartoszek, K. (2012). Interpreting the evolutionary regression: The interplay between observational and biological errors in phylogenetic comparative studies. Systematic Biology, 61(3), 413–425. <a href="https://doi.org/10.1093/sysbio/syr122" class="uri">https://doi.org/10.1093/sysbio/syr122</a><a href="#fnref6">↩</a></p></li>
<li id="fn7"><p>Hansen, T. F. (2014). Use and misuse of comparative methods in the study of adaptation. In Garamszegi &amp; L. Zsolt (Eds.), Modern Phylogenetic Comparative Methods and their Application in Evolutionary Biology (pp. 351–379). Springer. <a href="https://doi.org/10.1007/978-3-662-43550-2_14" class="uri">https://doi.org/10.1007/978-3-662-43550-2_14</a><a href="#fnref7">↩</a></p></li>
<li id="fn8"><p>O’Meara, B. C., &amp; Beaulieu, J. M. (2014). Modelling stabilizing selection: The attraction of Ornstein-Uhlenbeck models. In Garamszegi &amp; L. Zsolt (Eds.), Modern Phylogenetic Comparative Methods and their Application in Evolutionary Biology (pp. 381–393). Springer. <a href="https://doi.org/10.1007/978-3-662-43550-2_15" class="uri">https://doi.org/10.1007/978-3-662-43550-2_15</a><a href="#fnref8">↩</a></p></li>
<li id="fn9"><p>Toljagić, O., Voje, K. L., Matschiner, M., Liow, L. H., &amp; Hansen, T. F. (2017). Millions of years behind: Slow adaptation of ruminants to grasslands. Systematic Biology, (318). <a href="https://doi.org/10.1093/sysbio/syx059" class="uri">https://doi.org/10.1093/sysbio/syx059</a><a href="#fnref9">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Bjørn Tore Kopperud, Jason Pienaar, Kjetil Lysne Voje, Steven Hecht Orzack, Thomas F. Hansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
